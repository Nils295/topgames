<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Battle-Historie ‚Äì TopGames</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-900 text-white font-sans ">


    <header class=" text-white rounded-lg py-4 shadow-md sticky m0 p0 top-0 z-50">
        <div class="flex items-center justify-between">
          <!-- Logo -->
          <div class="flex items-center space-x-3 cursor-pointer" onclick="window.location.href='index.html'">
            <img src="Logo.png" alt="Logo" class="w-10 h-10 rounded-full ml-6">
            <span class="text-2xl font-bold">TopGames</span>
          </div>
      
          <!-- Navigation Buttons -->
          <nav class="flex space-x-4">
            <button class="px-4 py-2 bg-blue-600 rounded hover:bg-blue-500 transition" onclick="window.location.href='index.html'">Home</button>
            <button 
  onclick="window.location.href='battle.html'" 
  class="px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg transition">
  ‚öîÔ∏è Battle 
</button>
            <button class="px-4 py-2 bg-gray-700 rounded hover:bg-gray-600 transition" onclick="window.location.href='more.html'">Impressum</button>
          </nav>
        </div>
      
        
      </header>
 
  <h1 class="text-4xl font-bold text-center text-yellow-400 mb-6">üìÖ Battle-Historie</h1>
  <p class="text-center text-gray-400 mb-8">Alle bisherigen Daily Battles und ihre Ergebnisse ‚Äì inklusive Hall of Fame!</p>

  <div class="max-w-4xl mx-auto mb-12">
    <canvas id="battleChart" class="bg-gray-800 p-4 rounded-lg shadow-lg"></canvas>
  </div>

  <div id="historyList" class="max-w-4xl mx-auto space-y-6">
    <!-- Battle-Eintr√§ge werden hier eingef√ºgt -->
  </div>

  <div class="text-center mt-10">
    <a href="battle.html" class="text-blue-400 hover:underline">üîô Zur√ºck zum aktuellen Battle</a>
  </div>
  <main class="max-w-5xl mx-auto p-6 mt-10">


    <div class="" id="instantGamingBanner_Game1"></div>
  
    <script>
        window.igBannerConfig = {
            lang: 'de',
            igr: 'official-rankings',
            banners: {
                instantGamingBanner_Game1: { format: 'horizontal' }
            }
        };
    </script>
    <script src="https://www.instant-gaming.com/api/banner/partner/loader.js" defer></script>
  
  
  </main>
    
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBcZ-uTuqIjo2aGykHO8Z-AAYAj3XturJM",
      authDomain: "topgames-3a050.firebaseapp.com",
      databaseURL: "https://topgames-3a050-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "topgames-3a050",
      storageBucket: "topgames-3a050.appspot.com",
      messagingSenderId: "389330561319",
      appId: "1:389330561319:web:a9e313f393f0ae42d06102"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const historyRef = ref(db, "dailyBattle");
    const container = document.getElementById("historyList");

    const gameCovers = {
      "The Witcher 3": "https://upload.wikimedia.org/wikipedia/en/0/0c/Witcher_3_cover_art.jpg",
      "Elden Ring": "https://upload.wikimedia.org/wikipedia/en/b/b9/Elden_Ring_Box_art.jpg",
      "Cyberpunk 2077": "https://upload.wikimedia.org/wikipedia/en/9/9f/Cyberpunk_2077_box_art.jpg",
      "GTA V": "https://upload.wikimedia.org/wikipedia/en/a/a5/Grand_Theft_Auto_V.png",
      "Zelda_Breath_of_the_Wild": "https://upload.wikimedia.org/wikipedia/en/0/0e/The_Legend_of_Zelda_Breath_of_the_Wild.jpg"
    };

    const winCounter = {};

    get(historyRef).then(snapshot => {
      if (!snapshot.exists()) {
        container.innerHTML = "<p class='text-center text-gray-500'>Noch keine Battles vorhanden.</p>";
        return;
      }

      const data = snapshot.val();
      const sortedDates = Object.keys(data).sort((a, b) => b.localeCompare(a)); // neueste zuerst

      sortedDates.forEach(date => {
        const battle = data[date];
        const votes = battle.votes || {};
        const g1 = battle.game1;
        const g2 = battle.game2;
        const v1 = votes[g1] || 0;
        const v2 = votes[g2] || 0;

        const winner = v1 === v2 ? "Unentschieden" : (v1 > v2 ? g1 : g2);
        if (winner !== "Unentschieden") {
          winCounter[winner] = (winCounter[winner] || 0) + 1;
        }

        const entry = document.createElement("div");
        entry.className = "bg-gray-800 p-4 rounded-lg shadow-md";

        entry.innerHTML = `
          <h2 class="text-xl font-semibold text-blue-300 mb-2">${date}</h2>
          <div class="flex gap-6 items-center">
            <div class="flex items-center gap-3">
              <img src="${gameCovers[g1]}" class="w-16 h-16 object-cover rounded-lg" />
              <p class="text-gray-300">${g1}: <span class="font-bold text-yellow-400">${v1}</span></p>
            </div>
            <div class="flex items-center gap-3">
              <img src="${gameCovers[g2]}" class="w-16 h-16 object-cover rounded-lg" />
              <p class="text-gray-300">${g2}: <span class="font-bold text-yellow-400">${v2}</span></p>
            </div>
          </div>
          <p class="text-green-400 mt-2 font-semibold">üèÜ Gewinner: ${winner}</p>
        `;

        container.appendChild(entry);
      });

      renderChart(winCounter);
    });

    function renderChart(data) {
      const ctx = document.getElementById("battleChart").getContext("2d");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: Object.keys(data),
          datasets: [{
            label: "Anzahl Siege",
            data: Object.values(data),
            backgroundColor: "rgba(59, 130, 246, 0.7)",
            borderColor: "rgba(59, 130, 246, 1)",
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            title: {
              display: true,
              text: "üèÜ Siege pro Spiel",
              color: "#facc15",
              font: { size: 18 }
            }
          },
          scales: {
            x: {
              ticks: { color: "#ccc" },
              grid: { color: "#444" }
            },
            y: {
              beginAtZero: true,
              ticks: { color: "#ccc" },
              grid: { color: "#444" }
            }
          }
        }
      });
    }
  </script>

</body>
</html>
